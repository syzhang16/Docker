wb = xlsx_package.workbook

wb.add_worksheet(name: "Contacts") do |sheet|
  sheet.add_row ["ID", "Civilité", "Prénom", "Nom", "Téléphone", "Fax", "Mobile", "E-mail", "Fonction", "Notes", "Actif", "ID Compte", "Compte", "Adresse 1", "Adresse 2", "CP", "Ville", "Pays", "Téléphone Compte", "Fax compte", "Web", "E-mail compte", "Compte comptable", "Origine", "Activité", "Conditions de règlement", "SIRET", "NAF", "N° TVA", "C.A.", "C.A. prévisionnel", "Identifiant commercial", "Périodicité de facturation", "Compte actif"]
  @contacts.each do |contact|
    sheet.add_row [(contact.id), (contact.title), (contact.forename), (contact.surname), (contact.tel), (contact.fax), (contact.mobile), (contact.email), (contact.job), (contact.notes), (contact.active), (contact.account_id), (if !contact.account.blank? then contact.account.company end) , (if !contact.account.blank? then contact.account.adress1 end), (if !contact.account.blank? then contact.account.adress2 end), (if !contact.account.blank? then contact.account.zip end), (if !contact.account.blank? then contact.account.city end), (if !contact.account.blank? then contact.account.country end), (if !contact.account.blank? then contact.account.tel end), (if !contact.account.blank? then contact.account.fax end), (if !contact.account.blank? then contact.account.web end), (if !contact.account.blank? then contact.account.email end), (if !contact.account.blank? then contact.account.accounting_code end), (if (!contact.account.blank? and !contact.account.origin.blank?) then contact.account.origin.name end), (if (!contact.account.blank? and !contact.account.activity.blank?) then contact.account.activity.name end), (if (!contact.account.blank? and !contact.account.payment_term.blank?) then contact.account.payment_term.name end), (if !contact.account.blank? then contact.account.registration_number end), (if !contact.account.blank? then contact.account.business_sector_code end), (if !contact.account.blank? then contact.account.vat_number end), (if !contact.account.blank? then contact.account.turnover end), (if !contact.account.blank? then contact.account.projected_turnover end), (if !contact.account.blank? then contact.account.identifier end), (if !contact.account.blank? then contact.account.periodicity_billing end), (if !contact.account.blank? then contact.account.active end)]
  end
end
